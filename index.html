<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DF Messenger Demo – Missing Region Simulation</title>

  <!-- Default DF theme -->
  <link rel="stylesheet"
    href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">

  <!-- DF Messenger -->
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      margin: 24px;
    }
    .panel {
      max-width: 900px;
      padding: 16px;
      border: 1px solid #ddd;
      border-radius: 12px;
    }
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: end;
      margin-bottom: 12px;
    }
    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
    }
    select, input, button {
      padding: 8px 10px;
      font-size: 14px;
    }
    button { cursor: pointer; }
    pre {
      background: #f7f7f7;
      padding: 12px;
      border-radius: 8px;
      overflow: auto;
      max-height: 300px;
    }
    .muted {
      color: #666;
      font-size: 13px;
      line-height: 1.4;
    }

    /* Pin chatbot bottom-right */
    df-messenger-chat-bubble {
      position: fixed !important;
      right: 16px !important;
      bottom: 16px !important;
      z-index: 999999 !important;
      --df-messenger-chat-window-width: 360px;
      --df-messenger-chat-window-height: 560px;
    }
    df-messenger {
      position: fixed !important;
      right: 16px !important;
      bottom: 16px !important;
      z-index: 999999 !important;
    }
  </style>
</head>

<body>
  <h2>ChatBot Demo – Missing Region Simulation</h2>

  <div class="panel">
    <div class="row">
      <label>
        Language (param)
        <select id="language">
          <option value="en">English</option>
          <option value="zh-HK">Chinese (HK)</option>
          <option value="ja">Japanese</option>
        </select>
      </label>

      <label>
        Region (param)
        <select id="region">
          <option value="singapore">Singapore</option>
          <option value="southAfrica">South Africa</option>
        </select>
      </label>

      <label style="flex-direction: row; align-items: center; gap: 8px;">
        <input type="checkbox" id="omitRegion" />
        Simulate: frontend can’t get region
      </label>

      <button id="applyBtn">Apply parameters</button>
      <button id="sendHelloBtn">Send “hello”</button>
    </div>

    <p class="muted">
      ✔ If <b>Simulate: frontend can’t get region</b> is checked → <b>region is NOT sent at all</b>.<br/>
      ✔ CX should detect <code>$session.params.region = null</code> and ask user.<br/>
      ✔ Apply = setQueryParameters(), Send = sendQuery().
    </p>

    <h4>Parameters that will be sent</h4>
    <pre id="out">{}</pre>
  </div>

  <!-- Chatbot -->
  <df-messenger
    project-id="viu-pmo-poc"
    agent-id="d2fb0084-cb90-4de0-a8f1-caaed8f85603"
    language-code="en"
    max-query-length="256">
    <df-messenger-chat-bubble
      chat-title="Demo Bot"
      anchor="top-left"
      allow-fullscreen="small">
    </df-messenger-chat-bubble>
  </df-messenger>

  <script>
    const $ = (id) => document.getElementById(id);

    function buildParams() {
      const params = {
        language: $('language').value
      };

      // Only send region if frontend can get it
      if (!$('omitRegion').checked) {
        params.region = $('region').value;
      }

      return params;
    }

    function renderOut() {
      $('out').textContent = JSON.stringify(buildParams(), null, 2);
    }

    function getDf() {
      return document.querySelector('df-messenger');
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderOut();

      ['language', 'region', 'omitRegion'].forEach(id => {
        $(id).addEventListener('change', renderOut);
      });

      $('applyBtn').addEventListener('click', () => {
        const df = getDf();
        if (!df) return;

        const params = buildParams();
        df.setQueryParameters({ parameters: params });

        console.log('[Apply] setQueryParameters:', params);
        alert('Applied! Next message will use these parameters.');
      });

      $('sendHelloBtn').addEventListener('click', () => {
        const df = getDf();
        if (!df) return;

        df.sendQuery('hello');
      });
    });
  </script>
</body>
</html>
