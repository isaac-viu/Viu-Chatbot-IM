<!doctype html>
<html lang="en">
<<<<<<< HEAD

=======
>>>>>>> ac625b6f8bbdc998453b062c3b22e6535a4e21e4
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DF Messenger Demo – Full (params + new session + omit region)</title>

  <!-- Default theme -->
  <link rel="stylesheet"
    href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">

<<<<<<< HEAD
  <link rel="stylesheet" href="./styles.css" />

  <!-- DF Messenger -->
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

  <!-- External JS -->
  <script defer src="./app.js"></script>
=======
  <!-- DF Messenger -->
  <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 24px; }
    .panel { max-width: 980px; padding: 16px; border: 1px solid #ddd; border-radius: 12px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: end; margin-bottom: 12px; }
    label { display: flex; flex-direction: column; gap: 6px; font-size: 14px; }
    select, input, button { padding: 8px 10px; font-size: 14px; }
    button { cursor: pointer; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 8px; overflow: auto; max-height: 340px; }
    .muted { color: #666; font-size: 13px; line-height: 1.4; }

    /* Pin chatbot bottom-right + keep window in bounds */
    df-messenger-chat-bubble {
      position: fixed !important;
      right: 16px !important;
      bottom: 16px !important;
      z-index: 999999 !important;
      --df-messenger-chat-window-width: 360px;
      --df-messenger-chat-window-height: 560px;
      --df-messenger-chat-window-offset: 16px;
    }
    df-messenger {
      position: fixed !important;
      right: 16px !important;
      bottom: 16px !important;
      z-index: 999999 !important;
    }
  </style>
>>>>>>> ac625b6f8bbdc998453b062c3b22e6535a4e21e4
</head>

<body>
  <h2>ChatBot Demo – Full</h2>

  <div class="panel">
    <div class="row">
      <label>
        Language (param)
        <select id="language">
          <option value="en">English</option>
          <option value="zh-HK">Chinese (HK)</option>
          <option value="ja">Japanese</option>
        </select>
      </label>

      <label>
        Region (param)
        <select id="region">
          <option value="singapore">Singapore</option>
          <option value="southAfrica">South Africa</option>
        </select>
      </label>

      <label style="flex-direction: row; align-items: center; gap: 8px; padding-top: 22px;">
        <input type="checkbox" id="omitRegion" />
        Simulate: frontend can’t get region (do NOT send region)
      </label>

      <button id="applyBtn">Apply parameters</button>
      <button id="newSessionBtn">Start new session</button>
      <button id="sendHelloBtn">Send “hello”</button>
    </div>

    <p class="muted">
<<<<<<< HEAD
      • Apply = <code>setQueryParameters()</code> (sets default queryParams for subsequent messages).<br />
      • Start new session = <code>startNewSession()</code> (clears history; good for testing changes).<br />
      • If “omit region” is checked → <b>region key is completely omitted</b> (CX can detect
      <code>$session.params.region = null</code>).<br />
=======
      • Apply = <code>setQueryParameters()</code> (sets default queryParams for subsequent messages).<br/>
      • Start new session = <code>startNewSession()</code> (clears history; good for testing changes).<br/>
      • If “omit region” is checked → <b>region key is completely omitted</b> (CX can detect <code>$session.params.region = null</code>).<br/>
>>>>>>> ac625b6f8bbdc998453b062c3b22e6535a4e21e4
      • Extra context params are included every time: device/browser/page info.
    </p>

    <h4>Parameters that will be sent (preview)</h4>
    <pre id="out">{}</pre>
  </div>

  <!-- Chatbot -->
<<<<<<< HEAD
  <df-messenger project-id="viu-pmo-poc" agent-id="d2fb0084-cb90-4de0-a8f1-caaed8f85603" language-code="en"
    max-query-length="256">
    <df-messenger-chat-bubble chat-title="Demo Bot" anchor="top-left" allow-fullscreen="small">
    </df-messenger-chat-bubble>
  </df-messenger>

</body>

</html>
=======
  <df-messenger
    project-id="viu-pmo-poc"
    agent-id="d2fb0084-cb90-4de0-a8f1-caaed8f85603"
    language-code="en"
    max-query-length="256">
    <df-messenger-chat-bubble
      chat-title="Demo Bot"
      anchor="top-left"
      allow-fullscreen="small">
    </df-messenger-chat-bubble>
  </df-messenger>

  <script>
    const $ = (id) => document.getElementById(id);

    function isMobile() {
      return /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    }

    async function getBrowserInfo() {
      // Prefer UA-CH if available; fallback to userAgent only
      const ua = navigator.userAgent || "";
      let browserBrand = "";
      let browserVersion = "";
      let platform = navigator.platform || "";

      if (navigator.userAgentData?.getHighEntropyValues) {
        try {
          const high = await navigator.userAgentData.getHighEntropyValues([
            "platform", "fullVersionList", "uaFullVersion"
          ]);
          const brands = high.fullVersionList || navigator.userAgentData.brands || [];
          const main = brands.find(b => !/Not.*Brand/i.test(b.brand)) || brands[0] || {};
          browserBrand = main.brand || "";
          browserVersion = high.uaFullVersion || main.version || "";
          platform = high.platform || platform;
          return { browserBrand, browserVersion, platform, userAgent: ua };
        } catch (e) {
          // ignore and fallback
        }
      }

      // Very light fallback parsing (optional)
      // Keep userAgent always, leave brand/version empty if unknown
      return { browserBrand, browserVersion, platform, userAgent: ua };
    }

    async function buildParams() {
      const base = {
        // required params
        language: $('language').value,

        // extra context params
        device: isMobile() ? "mobile" : "desktop",
        pageUrl: location.href,
        pagePath: location.pathname,
        pageTitle: document.title
      };

      // region: omit entirely if simulate is enabled
      if (!$('omitRegion').checked) {
        base.region = $('region').value;
      }

      const browser = await getBrowserInfo();
      return { ...base, ...browser };
    }

    async function renderOut() {
      const params = await buildParams();
      $('out').textContent = JSON.stringify(params, null, 2);
    }

    function getDf() {
      return document.querySelector('df-messenger');
    }

    // Debug hooks (optional)
    window.addEventListener('df-messenger-loaded', () => console.log('[debug] df-messenger-loaded'));
    window.addEventListener('df-messenger-error', (e) => console.log('[debug] df-messenger-error:', e?.detail?.error || e));
    window.addEventListener('df-request-sent', (e) => console.log('[debug] df-request-sent requestBody:', e?.detail?.data?.requestBody));

    document.addEventListener('DOMContentLoaded', () => {
      renderOut();

      ['language', 'region', 'omitRegion'].forEach(id => {
        $(id).addEventListener('change', renderOut);
      });

      $('applyBtn').addEventListener('click', async () => {
        const df = getDf();
        if (!df) return;

        const params = await buildParams();
        df.setQueryParameters({ parameters: params });

        console.log('[Apply] setQueryParameters:', params);
        alert('Applied! Next message will include these parameters.');
      });

      $('newSessionBtn').addEventListener('click', () => {
        const df = getDf();
        if (!df) return;

        df.startNewSession();
        alert('New session started (history cleared).');
      });

      $('sendHelloBtn').addEventListener('click', () => {
        const df = getDf();
        if (!df) return;

        df.sendQuery('hello');
      });
    });
  </script>
</body>
</html>
>>>>>>> ac625b6f8bbdc998453b062c3b22e6535a4e21e4
